<!DOCTYPE html>
<html lang="en">
<head>
    <title>myHomeSim Pool</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link href='https://fonts.googleapis.com/css?family=Oxygen' rel='stylesheet' type='text/css'>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script src="/myUtils.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/template7/1.3.6/template7.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.1/lodash.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/string-format/0.5.0/string-format.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.2/locale/fr-ca.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/css/tooltipster.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/css/themes/tooltipster-shadow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/js/jquery.tooltipster.min.js"></script>

    <script>
      $.post($$myHomeSiteApiURL + '/login', {apikey: 'asdasjsdgfhgdsfjkjhg'}, function(data) {});
    </script>

    <style>
        body {
            background-color: #222222;
            font-family: 'Oxygen', Thaoma, Arial, sans-serif !important;
            font-weight: normal;
            color: white;
        }

        .poollbl {

            font-size: 60px;
            font-weight: bold;
            -webkit-animation-duration: 3s;
            -webkit-animation-delay: 2s;
            /*-webkit-animation-iteration-count: infinite;*/

        }

        .poolBox {
            background: url(img/pool-water.jpg) no-repeat center center fixed;

        }

        .meteoBox {
            background: url(img/sky.jpg) no-repeat center center fixed;

        }

        .meteolbl{
            font-size: 60px;
            font-weight: bold;

        }
        .col-sm {
            padding-bottom: 10px;
        }

        .homeBox {
            background: url(img/home.jpg) repeat center center;

        }
        .aquaBox {
            background: url(img/aqua.jpg) repeat center center;
        }
        
        .aqualbl {
            font-size: 42px;
        }
    </style>

<body>

  <div class="container">
      <div class="row">
          <div class="col-sm poolBox" style="text-align: center">
              <div class="tooltipex" data-tooltipex="roundNumber(((data.lastValue - 32) * 0.5556 ),2) + '°C'" data-myHomeSim="HJNiOwLZX">
                   <span class="poollbl">{icon.thermometer} {data.lastValue} °F {icon.pool} Piscine</span>
                   <div>dernière mise à jour: {data.lastDate}</div>
              </div>
          </div>
      </div>

      <div class="row">
          <div class="col-sm meteoBox" style="text-align: center">
              <div class="tooltipex" data-tooltipex="roundNumber(((data.lastValue * 1.8) + 32),2) + '°F'" data-myHomeSim="BJM3Cd00">
                  <span class="meteolbl">{icon.thermometer} {data.lastValue} °C Météo</span>
                  <div>dernière mise à jour: {data.lastDate}</div>
              </div>
          </div>
      </div>

      <div class="row">
          <div class="col-sm homeBox" style="text-align: center">
              <div class="tooltipex" data-tooltipex="roundNumber(((data.lastValue * 1.8) + 32),2) + '°F'" data-myHomeSim="rkgvOxjh-e">
                  <span class="meteolbl">{icon.thermometer} {data.lastValue} °C Maison</span>
                  <div>dernière mise à jour: {data.lastDate}</div>
              </div>
          </div>
      </div>

      <div class="row">
          <div class="col-sm aquaBox" style="text-align: center">


             <div data-myHomeSim="rJeeT8Rq5G" class="aqualbl" data-tooltipex="{data.lastDate}">{icon.thermometer} {data.lastValue} °F Scalaire Coupe</div>


             <div data-myHomeSim="BkHnWSZ-X" class="aqualbl">{icon.thermometer} {data.lastValue} °F Guppy</div>
             <div data-myHomeSim="BJOy6aw-7" class="aqualbl">{icon.thermometer} {data.lastValue} °F Salon</div>
          </div>
      </div>



  </div>


      <script>


          var icon = {
              'thermometer': "<i class='fas fa-thermometer-half'></i>",
              'pool': "<i class='fas fa-swimming-pool'></i>",
              'tint': "<i class='fa fa-tint' aria-hidden='true'></i>",
              'bars': "<i class='fa fa-bars' aria-hidden='true'></i>",
              'ok': "<i class='fa fa-check' aria-hidden='true'></i>",
              'fire': "<i class='fa fa-fire'></i>",
              'cancel': "<i class='fa fa-times' aria-hidden='true'></i>",
              'exclamation': "<i class='fa fa-exclamation-circle' aria-hidden='true'></i>",
              'battery': "<i class='fa fa-battery-full' aria-hidden='true'></i>",
              "bell": "<i class='fa fa-bell-o' aria-hidden='true'></i>",
              "bug": "<i class='fa fa-bug' aria-hidden='true'></i>",
              "pencil": "<i class='fa fa-pencil-square-o' aria-hidden='true'></i>"
          };

          var socket = io.connect($$myHomeSiteApiURL);



          function updateSensor(elem, data) {
              data.lastDate = moment(data.lastDate).format('D MMMM, h:mm:ss a');
              let html = $(elem).data('origHtml');
              $(elem).html(format(html, {icon, data: data}));
              let tooltipex = $(elem).attr('data-tooltipex');
              if (tooltipex) {
                  $(elem).tooltipster(
                    'content', format(eval(format(tooltipex, {icon, data: data})), {icon, data: data})
                  );
              }
              $(elem).animateCss('bounce', function() {});
          }


          var idToUpdate = [];
          socket.on('newSensorValue', function (data) {

              idFound =_.find(idToUpdate, { 'id': data._id });

              if (idFound )  {

                  updateSensor(idFound.elem, data);


                  //$('.tooltipex').tooltipster('content', ((data.lastValue - 32) * 0.5556 ) + '°C');

                  /*new Noty({
                      text: '<span style="font-size: x-large"><i class="fa fa-thermometer-half" aria-hidden="true"></i>&nbsp;' + data.lastValue + '&nbsp;°F</span>',
                      timeout: 1500,
                      killer: true,
                      type: 'information',
                      theme: 'relax',
                      layout: 'topCenter',
                      animation: {
                          open: 'animated bounceInDown', // Animate.css class names
                          close: 'animated bounceOutUp' // Animate.css class names
                      }
                  }).show();*/
              }
          });

          $("[data-myHomeSim]").each(function (index, elem) {
              var id = $(elem).attr('data-myHomeSim');
              $(elem).data('origHtml', $(elem).html());
              if ($(elem).attr('data-tooltipex'))
                $(elem).tooltipster({
                  theme: 'tooltipster-shadow',
                  content: '??'
              });
              $.getJSON($$myHomeSiteApiURL + '/api/sensor/' + id, function (data) {
                updateSensor(elem, data);
                idToUpdate.push({id: id, elem: $(elem)});
              });

          });
      </script>


</body>
</html>
